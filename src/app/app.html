<div class="container">

  <header class="main-header">
    <div class="logo">
      <h1>Electro<span class="highlight">Zone</span></h1>
    </div>

    <div class="cart-icon" (click)="toggleCart()">
      <i class='bx bx-shopping-bag'></i>
      <span class="badge" *ngIf="cart.length > 0">{{ cart.length }}</span>
    </div>
  </header>

  <div class="hero-section">
    <div class="hero-content">
      <span class="hero-badge">NUEVA COLECCIÓN 2024</span>
      <h2>Tecnología que define <br> tu estilo de vida</h2>
      <p>Descubre las últimas novedades en audio, gaming y fotografía con envíos gratuitos en 24h.</p>
      <button class="hero-btn" (click)="scrollToProducts()">Ver Catálogo</button>
    </div>
    <div class="hero-image">
      <img src="https://pngimg.com/d/headphones_PNG101984.png" alt="Hero Product">
    </div>
  </div>

  <p class="subtitle">Tecnología premium para ti.</p>

  <div class="toolbar">
    <div class="search-container">
      <i class='bx bx-search'></i>
      <input type="text" [(ngModel)]="searchTerm" placeholder="Buscar productos..." class="search-input">
    </div>

    <div class="sort-wrapper">
      <label>Ordenar:</label>
      <div class="custom-select">
        <select [(ngModel)]="sortOrder">
          <option value="default">Destacados</option>
          <option value="asc">Precio: Bajo a Alto</option>
          <option value="desc">Precio: Alto a Bajo</option>
        </select>
        <i class='bx bx-chevron-down'></i>
      </div>
    </div>
  </div>

  <div class="filters">
    <button [class.active]="selectedCategory === 'Todas'" (click)="setCategory('Todas')">Todas</button>
    <button [class.active]="selectedCategory === 'Audio'" (click)="setCategory('Audio')">Audio</button>
    <button [class.active]="selectedCategory === 'Wearables'" (click)="setCategory('Wearables')">Wearables</button>
    <button [class.active]="selectedCategory === 'Fotografía'" (click)="setCategory('Fotografía')">Fotografía</button>
    <button [class.active]="selectedCategory === 'Gaming'" (click)="setCategory('Gaming')">Gaming</button>
  </div>

  <div class="product-grid">
    <div class="card" *ngFor="let product of filteredProducts">

      <div class="image-wrapper">
        <img [src]="product.image" [alt]="product.name">

        <button class="wishlist-btn"
                [class.active]="isInWishlist(product.id)"
                (click)="toggleWishlist(product.id); $event.stopPropagation()">
          <i class='bx bxs-heart' *ngIf="isInWishlist(product.id)"></i>
          <i class='bx bx-heart' *ngIf="!isInWishlist(product.id)"></i>
        </button>

        <div class="overlay-card">
          <button class="view-btn" (click)="openDetails(product)">Ver Detalles</button>
        </div>
      </div>

      <div class="card-content">
        <span class="category">{{ product.category }}</span>

        <div class="rating">
          <i class='bx bxs-star' *ngFor="let star of getStars(product.rating)"
             [class.active]="star === 1"></i>
          <span class="rating-number">({{ product.rating || 4.5 }})</span>
        </div>

        <h3>{{ product.name }}</h3>
        <p class="description">{{ product.description }}</p>

        <div class="card-footer">
          <span class="price">{{ product.price | currency:'EUR':'symbol':'1.0-0' }}</span>

          <div class="action-buttons">
            <button class="compare-btn"
                    [class.active]="isInCompare(product)"
                    (click)="toggleCompare(product)"
                    title="Comparar">
              <i class='bx bx-bar-chart-alt-2'></i>
            </button>

            <button class="add-btn"
                    *ngIf="product.stock !== 0"
                    (click)="addToCart(product)">
              <i class='bx bx-cart-alt'></i> Añadir
            </button>

            <button class="add-btn disabled" *ngIf="product.stock === 0" disabled>
              Agotado
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="main-footer">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Electro<span class="highlight">Zone</span></h3>
        <p>Tu tienda de confianza.</p>
      </div>
      <div class="footer-section">
        <h4>Enlaces</h4>
        <a href="#">Inicio</a> <br> <a href="#">Ofertas</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 ElectroZone.</p>
    </div>
  </footer>

</div>
<div class="backdrop" *ngIf="isCartOpen" (click)="toggleCart()"></div>

<div class="cart-sidebar" [class.open]="isCartOpen">
  <div class="cart-header">
    <h2>Tu Carrito</h2>
    <button class="close-btn" (click)="toggleCart()"><i class='bx bx-x'></i></button>
  </div>

  <div class="cart-items" *ngIf="cart.length > 0; else emptyCart">
    <div class="cart-item" *ngFor="let item of cart; let i = index">
      <img [src]="item.image" alt="miniatura">
      <div class="item-details">
        <h4>{{ item.name }}</h4>
        <span class="item-price">{{ item.price | currency:'EUR' }}</span>
      </div>
      <button class="remove-btn" (click)="removeProduct(i)"><i class='bx bx-trash'></i></button>
    </div>
  </div>

  <ng-template #emptyCart>
    <div class="empty-state">
      <i class='bx bx-basket'></i><p>Tu carrito está vacío</p>
    </div>
  </ng-template>

  <div class="cart-footer-sidebar" *ngIf="cart.length > 0">
    <div class="total-row">
      <span>Total:</span><span class="total-amount">{{ totalCartPrice | currency:'EUR' }}</span>
    </div>
    <button class="checkout-btn" (click)="openCheckout()">Tramitar Pedido</button>
  </div>
</div>

<div class="checkout-backdrop" *ngIf="isCheckoutOpen">
  <div class="checkout-modal">
    <div class="modal-header">
      <h2>Finalizar Compra</h2>
      <button class="close-icon" (click)="closeCheckout()"><i class='bx bx-x'></i></button>
    </div>

    <div class="checkout-body">
      <div class="order-summary">
        <h3>Resumen del Pedido</h3>
        <p>Total a pagar: <strong>{{ totalCartPrice | currency:'EUR' }}</strong></p>
        <p>Artículos: {{ cart.length }}</p>
      </div>

      <form (ngSubmit)="submitOrder()">
        <div class="form-group">
          <label>Nombre Completo</label>
          <input type="text" [(ngModel)]="checkoutData.name" name="name" placeholder="Ej: Juan Pérez" required>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="checkoutData.email" name="email" placeholder="juan@ejemplo.com" required>
        </div>

        <div class="row">
          <div class="form-group">
            <label>Dirección</label>
            <input type="text" [(ngModel)]="checkoutData.address" name="address" placeholder="Calle Falsa 123" required>
          </div>
          <div class="form-group">
            <label>Ciudad</label>
            <input type="text" [(ngModel)]="checkoutData.city" name="city" placeholder="Madrid" required>
          </div>
        </div>

        <div class="form-group">
          <label>Tarjeta (Simulada)</label>
          <div class="card-input">
            <i class='bx bxl-visa'></i>
            <input type="text" [(ngModel)]="checkoutData.cardNumber" name="card" placeholder="0000 0000 0000 0000">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="cancel-btn" (click)="closeCheckout()">Cancelar</button>
          <button type="submit" class="pay-btn">Pagar {{ totalCartPrice | currency:'EUR' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="success-modal-wrapper" *ngIf="showSuccessModal">
  <div class="success-card">
    <div class="success-icon"><i class='bx bxs-badge-check'></i></div>
    <h2>¡Gracias por tu compra!</h2>
    <p>Tu pedido ha sido procesado correctamente.</p>
    <button (click)="showSuccessModal = false">Seguir comprando</button>
  </div>
</div>

<div class="toast" [class.show]="showNotification">
  <div class="toast-content">
    <i class='bx bxs-check-circle'></i>
    <div>
      <h4>¡Añadido al carrito!</h4>
      <p>{{ lastAddedProduct }}</p>
    </div>
  </div>
</div>

<div class="details-backdrop" *ngIf="selectedProduct" (click)="closeDetails()">
  <div class="details-modal" (click)="$event.stopPropagation()">

    <button class="close-details" (click)="closeDetails()">
      <i class='bx bx-x'></i>
    </button>

    <div class="details-content">
      <div class="details-image">
        <img [src]="selectedProduct.image" [alt]="selectedProduct.name">
      </div>

      <div class="details-info">
        <span class="details-category">{{ selectedProduct.category }}</span>
        <h2>{{ selectedProduct.name }}</h2>
        <div class="details-price">{{ selectedProduct.price | currency:'EUR' }}</div>

        <p class="details-description">
          {{ selectedProduct.description }}
          <br><br>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
        </p>

        <div class="details-actions">
          <button class="add-btn-large" (click)="addToCart(selectedProduct); closeDetails()">
            Añadir al Carrito
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="compare-bar" *ngIf="compareList.length > 0">
  <div class="compare-info">
    <span>{{ compareList.length }} / 2 Seleccionados</span>
    <small *ngIf="compareList.length === 1">Selecciona otro producto de {{ compareList[0].category }}</small>
  </div>

  <div class="compare-actions">
    <button class="clear-comp-btn" (click)="clearCompare()">Borrar</button>
    <button class="view-comp-btn"
            [disabled]="compareList.length < 2"
            (click)="showCompareModal = true">
      Ver Comparación
    </button>
  </div>
</div>

<div class="compare-backdrop" *ngIf="showCompareModal" (click)="showCompareModal = false">
  <div class="compare-modal" (click)="$event.stopPropagation()">
    <div class="compare-header">
      <h2>Comparativa</h2>
      <button class="close-icon" (click)="showCompareModal = false"><i class='bx bx-x'></i></button>
    </div>

    <div class="compare-grid">
      <div class="col-labels">
        <div class="row-header">Producto</div>
        <div class="row-item">Precio</div>
        <div class="row-item">Categoría</div>
        <div class="row-item">Descripción</div>
        <div class="row-item">Acción</div>
      </div>

      <div class="col-product" *ngFor="let item of compareList">
        <div class="row-header">
          <img [src]="item.image" class="comp-img">
          <h4>{{ item.name }}</h4>
        </div>
        <div class="row-item price-text">{{ item.price | currency:'EUR' }}</div>
        <div class="row-item category-tag">{{ item.category }}</div>
        <div class="row-item desc-text">{{ item.description }}</div>
        <div class="row-item">
          <button class="add-btn-small" (click)="addToCart(item); showCompareModal = false">
            Comprar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
